#LyX 2.3 created this file. For more info see http://www.lyx.org/
\lyxformat 544
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass article
\use_default_options true
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman "default" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\use_microtype false
\use_dash_ligatures true
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\use_hyperref false
\papersize default
\use_geometry false
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\use_minted 0
\index Index
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\is_math_indent 0
\math_numbering_side default
\quotes_style english
\dynamic_quotes 0
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Subparagraph*
Trace derivatives
\end_layout

\begin_layout Standard
\begin_inset Formula $\frac{\partial}{\partial X}\text{Tr}\left[AXB\right]=A^{\intercal}B^{\intercal}$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $\frac{\partial}{\partial X}\text{Tr}\left[AX^{\intercal}B\right]=BA$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $\frac{\partial}{\partial X}\text{Tr}\left[X^{\intercal}AX\right]=(A+A^{\intercal})X$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $\frac{\partial}{\partial X}\text{Tr}\left[AXBX^{\intercal}C\right]=\frac{\partial}{\partial X}\text{Tr}\left[AXD\right]+\frac{\partial}{\partial X}\text{Tr}\left[EX^{\intercal}C\right]=A^{\intercal}D^{\intercal}+EC$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $D=BX^{\intercal}C$
\end_inset

 and 
\begin_inset Formula $E=AXB$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $\frac{\partial}{\partial X}\text{Tr}\left[AXBX^{\intercal}C\right]=A^{\intercal}C^{\intercal}XB^{\intercal}+AXBC$
\end_inset


\end_layout

\begin_layout Standard
If 
\begin_inset Formula $C$
\end_inset

 is the identity and 
\begin_inset Formula $A$
\end_inset

 and 
\begin_inset Formula $B$
\end_inset

 are symmetric
\end_layout

\begin_layout Standard
\begin_inset Formula $\frac{\partial}{\partial X}\text{Tr}\left[A_{\text{sym}}XB_{\text{sym}}X^{\intercal}\right]=2AXB$
\end_inset


\end_layout

\begin_layout Standard
Complete data log likelihood
\end_layout

\begin_layout Standard
\begin_inset Formula $\mathbb{E}\left[\sum_{t=1}^{T}\log\mathcal{N}(y_{t};Cx_{t},R)\right]=-\frac{1}{2}\mathbb{E}\left[\sum_{t=1}^{T}(y_{t}-Cx_{t}-Du_{t}-d)^{\intercal}R^{-1}(y_{t}-Cx_{t}-Du_{t}-d)\right]-\frac{T}{2}\log|2\pi R|$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $=-\frac{1}{2}\text{Tr}\left[R^{-1}\sum_{t=1}^{T}y_{t}y_{t}^{\intercal}-2R^{-1}C\sum_{t=1}^{T}\mathbb{E}[x_{t}y_{t}^{\intercal}]-2R^{-1}D\sum_{t=1}^{T}u_{t}y_{t}^{\intercal}-2R^{-1}\sum_{t=1}^{T}y_{t}d^{\intercal}+C^{\intercal}R^{-1}C\sum_{t=1}^{T}\mathbb{E}[x_{t}x_{t}^{\intercal}]+2R^{-1}C\sum_{t=1}^{T}\mathbb{E}[x_{t}d^{\intercal}]+D^{\intercal}R^{-1}D\sum_{t=1}^{T}u_{t}u_{t}^{\intercal}+2R^{-1}D\sum_{t=1}^{T}u_{t}d^{\intercal}+R^{-1}Tdd^{\intercal}\right]-\frac{T}{2}\log|2\pi R|$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $=-\frac{1}{2}\text{Tr}\left[R^{-1}\sum_{t=1}^{T}y_{t}y_{t}^{\intercal}-2R^{-1}C\sum_{t=1}^{T}m_{t}y_{t}^{\intercal}-2R^{-1}D\sum_{t=1}^{T}u_{t}y_{t}^{\intercal}-2R^{-1}\sum_{t=1}^{T}y_{t}d^{\intercal}+C^{\intercal}R^{-1}C\sum_{t=1}^{T}m_{t}m_{t}^{\intercal}+2R^{-1}C\sum_{t=1}^{T}m_{t}d^{\intercal}+D^{\intercal}R^{-1}D\sum_{t=1}^{T}u_{t}u_{t}^{\intercal}+2R^{-1}D\sum_{t=1}^{T}u_{t}d^{\intercal}+R^{-1}Tdd^{\intercal}\right]-\frac{T}{2}\log|2\pi R|$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $=-\frac{1}{2}\text{Tr}\left[R^{-1}\sum_{t=1}^{T}y_{t}y_{t}^{\intercal}\right]+\text{Tr}\left[R^{-1}C\sum_{t=1}^{T}m_{t}y_{t}^{\intercal}\right]+\text{Tr}\left[R^{-1}D\sum_{t=1}^{T}u_{t}y_{t}^{\intercal}\right]+\text{Tr}\left[R^{-1}\sum_{t=1}^{T}y_{t}d^{\intercal}\right]-\frac{1}{2}\text{Tr}\left[C^{\intercal}R^{-1}C\sum_{t=1}^{T}m_{t}m_{t}^{\intercal}\right]-\text{Tr}\left[R^{-1}C\sum_{t=1}^{T}m_{t}d^{\intercal}\right]-\frac{1}{2}\text{Tr}\left[D^{\intercal}R^{-1}D\sum_{t=1}^{T}u_{t}u_{t}^{\intercal}\right]-\text{Tr}\left[R^{-1}D\sum_{t=1}^{T}u_{t}d^{\intercal}\right]-\frac{T}{2}\text{Tr}\left[R^{-1}dd^{\intercal}\right]-\frac{T}{2}\log|2\pi R|$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $=-\frac{1}{2}\text{Tr}\left[R^{-1}Y\right]+\text{Tr}\left[R^{-1}C\tilde{Y}\right]+\text{Tr}\left[R^{-1}DU_{y}\right]+\text{Tr}\left[R^{-1}\sum_{t=1}^{T}y_{t}d^{\intercal}\right]-\frac{1}{2}\text{Tr}\left[C^{\intercal}R^{-1}CM_{(1,T)}\right]-\text{Tr}\left[R^{-1}C\sum_{t=1}^{T}m_{t}d^{\intercal}\right]-\frac{1}{2}\text{Tr}\left[D^{\intercal}R^{-1}D\sum_{t=1}^{T}U_{(1,T)}\right]-\text{Tr}\left[R^{-1}D\sum_{t=1}^{T}u_{t}d^{\intercal}\right]-\frac{T}{2}\text{Tr}\left[R^{-1}dd^{\intercal}\right]-\frac{T}{2}\log|2\pi R|$
\end_inset


\end_layout

\begin_layout Standard
Derivative with respect to 
\begin_inset Formula $d$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $\frac{\partial L_{CD}}{\partial d}=R^{-1}\sum_{t=1}^{T}y_{t}-R^{-1}C\sum_{t=1}^{T}m_{t}-R^{-1}D\sum_{t=1}^{T}u_{t}-R^{-1}Td$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $\frac{\partial L_{CD}}{\partial R^{-1}}=-\frac{1}{2}Y+\frac{1}{2}C\tilde{Y}+\frac{1}{2}\tilde{Y}^{\intercal}C^{\intercal}+\frac{1}{2}DU_{y}+\frac{1}{2}U_{y}^{\intercal}D^{\intercal}+\frac{1}{2}\sum_{t=1}^{T}y_{t}d^{\intercal}+\frac{1}{2}d\sum_{t=1}^{T}y_{t}^{\intercal}-\frac{1}{2}CM_{(1,T)}C^{\intercal}-\frac{1}{2}C\sum_{t=1}^{T}m_{t}d^{\intercal}-\frac{1}{2}d\sum_{t=1}^{T}m_{t}^{\intercal}C^{\intercal}-\frac{1}{2}D\sum_{t=1}^{T}U_{(1,T)}D^{\intercal}-\frac{1}{2}D\sum_{t=1}^{T}u_{t}d^{\intercal}-\frac{1}{2}d\sum_{t=1}^{T}u_{t}^{\intercal}D^{\intercal}-\frac{T}{2}dd^{\intercal}+\frac{T}{2}R$
\end_inset


\end_layout

\begin_layout Standard
Set to 0
\end_layout

\begin_layout Standard
For 
\begin_inset Formula $d$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $0=R^{-1}\sum_{t=1}^{T}y_{t}-R^{-1}C\sum_{t=1}^{T}m_{t}-R^{-1}D\sum_{t=1}^{T}u_{t}-R^{-1}Td$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $0=\sum_{t=1}^{T}y_{t}-C\sum_{t=1}^{T}m_{t}-D\sum_{t=1}^{T}u_{t}-Td$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $d=\frac{1}{T}\left(\sum_{t=1}^{T}y_{t}-C\sum_{t=1}^{T}m_{t}-D\sum_{t=1}^{T}u_{t}\right)$
\end_inset


\end_layout

\begin_layout Standard
for 
\begin_inset Formula $R$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $0=-\frac{1}{2}Y+\frac{1}{2}C\tilde{Y}+\frac{1}{2}\tilde{Y}^{\intercal}C^{\intercal}+\frac{1}{2}DU_{y}+\frac{1}{2}U_{y}^{\intercal}D^{\intercal}+\frac{1}{2}\sum_{t=1}^{T}y_{t}d^{\intercal}+\frac{1}{2}d\sum_{t=1}^{T}y_{t}^{\intercal}-\frac{1}{2}CM_{(1,T)}C^{\intercal}-\frac{1}{2}C\sum_{t=1}^{T}m_{t}d^{\intercal}-\frac{1}{2}d\sum_{t=1}^{T}m_{t}^{\intercal}C^{\intercal}-\frac{1}{2}D\sum_{t=1}^{T}U_{(1,T)}D^{\intercal}-\frac{1}{2}D\sum_{t=1}^{T}u_{t}d^{\intercal}-\frac{1}{2}d\sum_{t=1}^{T}u_{t}^{\intercal}D^{\intercal}-\frac{T}{2}dd^{\intercal}+\frac{T}{2}R$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $R=\frac{1}{T}\left(Y-C\tilde{Y}-\tilde{Y}^{\intercal}C^{\intercal}-DU_{y}-U_{y}^{\intercal}D^{\intercal}-\sum_{t=1}^{T}y_{t}d^{\intercal}-d\sum_{t=1}^{T}y_{t}^{\intercal}+CM_{(1,T)}C^{\intercal}+C\sum_{t=1}^{T}m_{t}d^{\intercal}+d\sum_{t=1}^{T}m_{t}^{\intercal}C^{\intercal}+D\sum_{t=1}^{T}U_{(1,T)}D^{\intercal}+D\sum_{t=1}^{T}u_{t}d^{\intercal}+d\sum_{t=1}^{T}u_{t}^{\intercal}D^{\intercal}\right)+dd^{\intercal}$
\end_inset


\end_layout

\begin_layout Standard
Multiple data sets
\end_layout

\begin_layout Standard
\begin_inset Formula $=-\frac{1}{2}\text{Tr}\left[R^{-1}\sum_{i=1}^{W}Y_{i}\right]+\text{Tr}\left[R^{-1}C\sum_{i=1}^{W}\tilde{Y}_{i}\right]+\text{Tr}\left[R^{-1}D\sum_{i=1}^{W}U_{y,i}\right]+\text{Tr}\left[R^{-1}\sum_{i=1}^{W}\sum_{t=1}^{T}y_{t,i}d_{i}^{\intercal}\right]-\frac{1}{2}\text{Tr}\left[C^{\intercal}R^{-1}C\sum_{i=1}^{W}M_{(1,T),i}\right]-\text{Tr}\left[R^{-1}C\sum_{i=1}^{W}\sum_{t=1}^{T}m_{t,i}d_{i}^{\intercal}\right]-\frac{1}{2}\text{Tr}\left[D^{\intercal}R^{-1}D\sum_{i=1}^{W}\sum_{t=1}^{T}U_{(1,T),i}\right]-\text{Tr}\left[R^{-1}D\sum_{i=1}^{W}\sum_{t=1}^{T}u_{t,i}d_{i}^{\intercal}\right]-\sum_{i=1}^{W}\frac{T_{i}}{2}\text{Tr}\left[R^{-1}d_{i}d_{i}^{\intercal}\right]-\log|2\pi R|\sum_{i=1}^{W}\frac{T_{i}}{2}$
\end_inset


\end_layout

\begin_layout Standard
So this works similarly except the suff stats for updating 
\begin_inset Formula $R$
\end_inset

 
\begin_inset Formula $d$
\end_inset

 now get multiplied and summed for each data set (i.e) 
\begin_inset Formula $\sum_{i=1}^{W}\sum_{t=1}^{T}y_{t,i}d_{i}^{\intercal}$
\end_inset


\end_layout

\begin_layout Standard
The one change is to the 
\begin_inset Formula $dd^{\intercal}$
\end_inset

 term
\end_layout

\begin_layout Standard
\begin_inset Formula $\frac{\partial}{\partial R^{-1}}\sum_{i=1}^{W}\frac{T_{i}}{2}\text{Tr}\left[R^{-1}d_{i}d_{i}^{\intercal}\right]=\frac{1}{2}\sum_{i=1}^{W}T_{i}d_{i}d_{i}^{\intercal}$
\end_inset


\end_layout

\end_body
\end_document
